<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/html">
  <head>
      <meta charset="utf-8">
      <title>CDTO-09</title>

      <!-- CSS -->
      <link href="css/styles.css" rel="stylesheet" type="text/css">

  </head>
  <body>

  <div class="container">
      <div class="header">
          <h1>Oh Hey we got some stuff there!!</h1>
      </div>
      <div class="main"></div>
      <div id="footer"></div>
  </div>

  <!-- sockets -->
  <script src="./js/primus.js" type="text/javascript"></script>
  <!-- midi.js package -->
   <script src="./js/MIDI/AudioDetect.js" type="text/javascript"></script>
   <script src="./js/MIDI/LoadPlugin.js" type="text/javascript"></script>
   <script src="./js/MIDI/Plugin.js" type="text/javascript"></script>
   <script src="./js/MIDI/Player.js" type="text/javascript"></script>
   <script src="./js/Window/DOMLoader.XMLHttp.js" type="text/javascript"></script>
   <!-- extras -->
   <script src="./inc/Base64.js" type="text/javascript"></script>
   <script src="./inc/base64binary.js" type="text/javascript"></script>
   <!-- jquery -->
  <script src="//code.jquery.com/jquery-1.11.1.min.js" type="text/javascript"></script>


   <script type="text/javascript">

    function playSingle(channel, note, velocity, delay){
      MIDI.noteOn(channel, note, velocity, delay);
    }

    //NOISEY TINGZ!!! 
    $(document).ready(function(){

      var instruments = [ "agogo", "celesta", "glockenspiel", "electric_bass_pick" ];
      var programNumMappings = {
        agogo: 133,
        celesta: 8,
        glockenspiel: 9,
        electric_bass_pick: 34
      }
      
      MIDI.loadPlugin({
        soundfontUrl: "./soundfont/",
        instruments: instruments,
        callback: function() {
          //map the instruments to seperate channels
          for (var i = 0; i < instruments.length; i++){
            MIDI.programChange(i, programNumMappings[instruments[i]]);
          }
          console.log("We're all set up on %d channels!", instruments.length);  
        }
      });

      //Socket stuff
      var primus = Primus.connect('http://localhost:8080');
      primus.on('open', function () {
        primus.send('noise maker join', function(){
          console.log('successfully joined noisemaker room!');
        }); //can have callback

        primus.on('play note 1', function(data){
          console.log(data);
          playSingle(0, 50, 127, 0);
          console.log("played note 1!");
        });
      });
    });

  </script>

  </body>
</html>
